{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "contracts/product_candidates.schema.json",
    "title": "ProductCandidatesPack",
    "type": "object",
    "required": ["x_contract_version", "request", "candidates"],
    "additionalProperties": false,
    "properties": {
      "x_contract_version": { "type": "string", "const": "1.0" },
      "request": {
        "type": "object",
        "required": ["query_signature"],
        "additionalProperties": false,
        "properties": {
          "query_signature": { "type": "string", "minLength": 1 },
          "destination": { "type": ["string", "null"] },
          "market": { "type": ["string", "null"], "description": "e.g. BR, US" },
          "lang": { "type": ["string", "null"] },
          "limit": { "type": ["integer", "null"], "minimum": 1 },
          "min_confidence": { "type": ["number", "null"], "minimum": 0.0, "maximum": 1.0 }
        }
      },
      "candidates": {
        "type": "array",
        "items": { "$ref": "#/$defs/ProductCandidate" }
      }
    },
    "$defs": {
      "ProductCandidate": {
        "type": "object",
        "required": ["product_id", "summary", "merchant", "link", "confidence", "categories"],
        "additionalProperties": false,
        "properties": {
          "product_id": { "type": "string", "minLength": 8 },
          "summary": { "type": "string", "minLength": 10 },
          "merchant": { "type": "string" },
          "link": { "type": "string", "minLength": 8 },
          "categories": { "type": "array", "items": { "type": "string" } },
          "primary_category": { "type": ["string", "null"] },
          "triggers": { "type": ["array", "null"], "items": { "type": "string" } },
          "constraints": { "type": ["array", "null"], "items": { "type": "string" } },
          "affiliate_priority": { "type": ["number", "null"], "minimum": 0.0, "maximum": 1.0 },
          "user_value": { "type": ["number", "null"], "minimum": 0.0, "maximum": 1.0 },
          "confidence": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
          "score": {
            "type": ["object", "null"],
            "additionalProperties": false,
            "properties": {
              "distance": { "type": ["number", "null"] },
              "rank": { "type": ["integer", "null"] }
            }
          }
        }
      }
    }
  }
  